===============================================================================
                        æ€.å‡¡é‚®ç®±ç³»ç»Ÿéƒ¨ç½²æŒ‡å— v2.0
===============================================================================

ğŸ“‹ æ–‡æ¡£ä¿¡æ¯
-----------
- æ–‡æ¡£ç‰ˆæœ¬: v2.0.0
- ç³»ç»Ÿç‰ˆæœ¬: v2.0.0
- æ›´æ–°æ—¶é—´: 2025-08-08
- ç»´æŠ¤å›¢é˜Ÿ: æ€.å‡¡å¼€å‘å›¢é˜Ÿ
- æŠ€æœ¯æ”¯æŒ: QQ 2014131458
- é‚®ç®±æ”¯æŒ: 2014131458@qq.com

ğŸ¯ éƒ¨ç½²æ¦‚è¿°
-----------
æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨ä¸åŒç¯å¢ƒä¸­éƒ¨ç½²æ€.å‡¡é‚®ç®±ç³»ç»Ÿï¼ŒåŒ…æ‹¬å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒã€‚
ç³»ç»Ÿæ”¯æŒå¤šç§éƒ¨ç½²æ–¹å¼ï¼šæºç éƒ¨ç½²ã€Dockeréƒ¨ç½²ã€äºŒè¿›åˆ¶éƒ¨ç½²ç­‰ã€‚

âš ï¸ **é‡è¦æé†’**
- ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰è¯·ä»”ç»†é˜…è¯»å®‰å…¨é…ç½®ç« èŠ‚
- å»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯æ‰€æœ‰åŠŸèƒ½
- éƒ¨ç½²å‰è¯·å¤‡ä»½ç°æœ‰æ•°æ®
- ç¡®ä¿æœåŠ¡å™¨æ»¡è¶³æœ€ä½é…ç½®è¦æ±‚

===============================================================================
ç›®å½•
===============================================================================

1. ç³»ç»Ÿè¦æ±‚
2. ç¯å¢ƒå‡†å¤‡
3. æºç éƒ¨ç½²
4. Dockeréƒ¨ç½²
5. é…ç½®è¯´æ˜
6. å¯åŠ¨æœåŠ¡
7. éªŒè¯éƒ¨ç½²
8. å¸¸è§é—®é¢˜
9. å®‰å…¨é…ç½®
10. æ€§èƒ½ä¼˜åŒ–

===============================================================================
1. ç³»ç»Ÿè¦æ±‚
===============================================================================

1.1 ç¡¬ä»¶è¦æ±‚
-----------

**ğŸ”§ æœ€ä½é…ç½®** (é€‚ç”¨äºæµ‹è¯•ç¯å¢ƒ):
- CPU: 1æ ¸å¿ƒ (x86_64/ARM64)
- å†…å­˜: 512MB RAM
- ç£ç›˜: 1GBå¯ç”¨ç©ºé—´ (SSDæ¨è)
- ç½‘ç»œ: 1Mbpså¸¦å®½

**âš¡ æ¨èé…ç½®** (é€‚ç”¨äºå°å‹ç”Ÿäº§ç¯å¢ƒ):
- CPU: 2æ ¸å¿ƒæˆ–ä»¥ä¸Š
- å†…å­˜: 2GB RAMæˆ–ä»¥ä¸Š
- ç£ç›˜: 10GBå¯ç”¨ç©ºé—´ (SSDå¼ºçƒˆæ¨è)
- ç½‘ç»œ: 10Mbpså¸¦å®½æˆ–ä»¥ä¸Š

**ğŸš€ é«˜æ€§èƒ½é…ç½®** (é€‚ç”¨äºå¤§å‹ç”Ÿäº§ç¯å¢ƒ):
- CPU: 4æ ¸å¿ƒæˆ–ä»¥ä¸Š
- å†…å­˜: 8GB RAMæˆ–ä»¥ä¸Š
- ç£ç›˜: 50GBå¯ç”¨ç©ºé—´ (NVMe SSD)
- ç½‘ç»œ: 100Mbpså¸¦å®½æˆ–ä»¥ä¸Š
- è´Ÿè½½å‡è¡¡: æ”¯æŒå¤šå®ä¾‹éƒ¨ç½²

1.2 æ“ä½œç³»ç»Ÿæ”¯æŒ
---------------

**âœ… å®Œå…¨æ”¯æŒ**:
- Ubuntu 20.04+ / 22.04+ (æ¨è)
- CentOS 7+ / Rocky Linux 8+
- Debian 10+ / 11+
- Windows 10+ / Windows Server 2019+
- macOS 10.15+ (å¼€å‘ç¯å¢ƒ)

**ğŸ”§ æ¶æ„æ”¯æŒ**:
- x86_64 (AMD64) - ä¸»è¦æ”¯æŒ
- ARM64 (AArch64) - å®éªŒæ€§æ”¯æŒ
- ARM32 - æœ‰é™æ”¯æŒ

1.3 è½¯ä»¶ä¾èµ–
-----------

**å¿…éœ€è½¯ä»¶**:
- Go 1.21+ (ç¼–è¯‘ç¯å¢ƒ)
- Git 2.0+ (ä»£ç ç®¡ç†)
- SQLite 3.35+ (æ•°æ®åº“ï¼Œè‡ªåŠ¨åŒ…å«)

**å¯é€‰è½¯ä»¶**:
- Docker 20.10+ (å®¹å™¨éƒ¨ç½²)
- Docker Compose 2.0+ (ç¼–æ’éƒ¨ç½²)
- Nginx 1.18+ (åå‘ä»£ç†)
- Let's Encrypt (SSLè¯ä¹¦)
- Prometheus (ç›‘æ§)
- Grafana (å¯è§†åŒ–)

**å¼€å‘å·¥å…·**:
- VS Code / GoLand (IDE)
- Postman / Insomnia (APIæµ‹è¯•)
- SQLite Browser (æ•°æ®åº“ç®¡ç†)
- Git GUIå·¥å…·

1.4 ç½‘ç»œè¦æ±‚
-----------

**ç«¯å£è§„åˆ’**:
- 8080: Webç®¡ç†ç•Œé¢ (HTTP)
- 8443: Webç®¡ç†ç•Œé¢ (HTTPS)
- 25: SMTP (æ ‡å‡†é‚®ä»¶å‘é€)
- 587: SMTP (STARTTLSæäº¤)
- 465: SMTPS (SSLåŠ å¯†å‘é€)
- 143: IMAP (é‚®ä»¶æ¥æ”¶)
- 993: IMAPS (SSLåŠ å¯†æ¥æ”¶)
- 110: POP3 (é‚®ä»¶ä¸‹è½½)
- 995: POP3S (SSLåŠ å¯†ä¸‹è½½)

**é˜²ç«å¢™é…ç½®**:
```bash
# Ubuntu/Debian (ufw)
sudo ufw allow 8080/tcp
sudo ufw allow 25/tcp
sudo ufw allow 587/tcp
sudo ufw allow 465/tcp
sudo ufw allow 143/tcp
sudo ufw allow 993/tcp
sudo ufw allow 110/tcp
sudo ufw allow 995/tcp

# CentOS/RHEL (firewalld)
sudo firewall-cmd --permanent --add-port=8080/tcp
sudo firewall-cmd --permanent --add-port=25/tcp
sudo firewall-cmd --permanent --add-port=587/tcp
sudo firewall-cmd --permanent --add-port=465/tcp
sudo firewall-cmd --permanent --add-port=143/tcp
sudo firewall-cmd --permanent --add-port=993/tcp
sudo firewall-cmd --permanent --add-port=110/tcp
sudo firewall-cmd --permanent --add-port=995/tcp
sudo firewall-cmd --reload
```

**DNSè¦æ±‚**:
- Aè®°å½•: æŒ‡å‘æœåŠ¡å™¨IP
- MXè®°å½•: é‚®ä»¶äº¤æ¢è®°å½•
- SPFè®°å½•: å‘ä»¶äººç­–ç•¥æ¡†æ¶
- DKIMè®°å½•: åŸŸåå¯†é’¥è¯†åˆ«é‚®ä»¶
- DMARCè®°å½•: åŸŸåæ¶ˆæ¯è®¤è¯æŠ¥å‘Šä¸€è‡´æ€§

1.5 å®‰å…¨è¦æ±‚
-----------

**ç³»ç»Ÿå®‰å…¨**:
- å®šæœŸæ›´æ–°æ“ä½œç³»ç»Ÿ
- é…ç½®é˜²ç«å¢™è§„åˆ™
- ç¦ç”¨ä¸å¿…è¦çš„æœåŠ¡
- ä½¿ç”¨érootç”¨æˆ·è¿è¡Œ

**åº”ç”¨å®‰å…¨**:
- ä¿®æ”¹é»˜è®¤å¯†ç 
- é…ç½®SSLè¯ä¹¦
- å¯ç”¨è®¿é—®æ—¥å¿—
- è®¾ç½®IPç™½åå•

**æ•°æ®å®‰å…¨**:
- å®šæœŸå¤‡ä»½æ•°æ®
- åŠ å¯†æ•æ„Ÿä¿¡æ¯
- ç›‘æ§å¼‚å¸¸è®¿é—®
- è®¾ç½®æ•°æ®ä¿ç•™ç­–ç•¥

===============================================================================
2. ç¯å¢ƒå‡†å¤‡
===============================================================================

2.1 å®‰è£…Goè¯­è¨€ç¯å¢ƒ

Linux/macOS:
```bash
wget https://golang.org/dl/go1.21.0.linux-amd64.tar.gz
sudo tar -C /usr/local -xzf go1.21.0.linux-amd64.tar.gz
export PATH=$PATH:/usr/local/go/bin
echo 'export PATH=$PATH:/usr/local/go/bin' >> ~/.bashrc
source ~/.bashrc
```

Windows:
1. ä¸‹è½½Goå®‰è£…åŒ…: https://golang.org/dl/
2. è¿è¡Œå®‰è£…ç¨‹åº
3. é…ç½®ç¯å¢ƒå˜é‡GOPATHå’ŒGOROOT

2.2 éªŒè¯Goå®‰è£…
```bash
go version
```

2.3 é…ç½®Goæ¨¡å—ä»£ç†(å¯é€‰)
```bash
go env -w GOPROXY=https://goproxy.cn,direct
go env -w GOSUMDB=sum.golang.google.cn
```

===============================================================================
3. æºç éƒ¨ç½²
===============================================================================

3.1 å…‹éš†é¡¹ç›®
```bash
git clone <repository-url>
cd mikoé‚®ç®±
```

3.2 å®‰è£…ä¾èµ–
```bash
go mod tidy
```

3.3 ç¼–è¯‘é¡¹ç›®
```bash
# ç¼–è¯‘å½“å‰å¹³å°
go build -o miko-email main.go

# äº¤å‰ç¼–è¯‘Linuxç‰ˆæœ¬
GOOS=linux GOARCH=amd64 go build -o miko-email-linux main.go

# äº¤å‰ç¼–è¯‘Windowsç‰ˆæœ¬
GOOS=windows GOARCH=amd64 go build -o miko-email.exe main.go
```

3.4 åˆ›å»ºå¿…è¦ç›®å½•
```bash
mkdir -p logs
mkdir -p data
mkdir -p dkim_keys
```

===============================================================================
4. Dockeréƒ¨ç½²
===============================================================================

4.1 åˆ›å»ºDockerfile
```dockerfile
FROM golang:1.21-alpine AS builder

WORKDIR /app
COPY go.mod go.sum ./
RUN go mod download

COPY . .
RUN go build -o miko-email main.go

FROM alpine:latest
RUN apk --no-cache add ca-certificates
WORKDIR /root/

COPY --from=builder /app/miko-email .
COPY --from=builder /app/web ./web
COPY --from=builder /app/config.yaml .

EXPOSE 8080 25 143 110

CMD ["./miko-email"]
```

4.2 æ„å»ºDockeré•œåƒ
```bash
docker build -t miko-email:latest .
```

4.3 è¿è¡ŒDockerå®¹å™¨
```bash
docker run -d \
  --name miko-email \
  -p 8080:8080 \
  -p 25:25 \
  -p 143:143 \
  -p 110:110 \
  -v $(pwd)/data:/root/data \
  -v $(pwd)/logs:/root/logs \
  miko-email:latest
```

4.4 Docker Composeéƒ¨ç½²
```yaml
version: '3.8'
services:
  miko-email:
    build: .
    ports:
      - "8080:8080"
      - "25:25"
      - "143:143"
      - "110:110"
    volumes:
      - ./data:/root/data
      - ./logs:/root/logs
      - ./config.yaml:/root/config.yaml
    restart: unless-stopped
```

===============================================================================
5. é…ç½®è¯´æ˜
===============================================================================

5.1 åŸºç¡€é…ç½® (config.yaml)
```yaml
server:
  web_port: 8080
  smtp:
    enable_multi_port: true
    port_25: 25
    port_587: 587
    port_465: 465
  imap:
    port: 143
  pop3:
    port: 110

database:
  path: "./data/miko_email.db"
  debug: false

security:
  session_key: "your-secret-session-key"
  jwt_secret: "your-jwt-secret-key"
  session_timeout: 24

email:
  max_size: 25
  max_mailboxes_per_user: 10
  enable_forwarding: true

admin:
  username: "admin"
  password: "123456"
  email: "2014131458@qq.com"
```

5.2 ç¯å¢ƒå˜é‡é…ç½®
```bash
export WEB_PORT=8080
export SMTP_PORT=25
export IMAP_PORT=143
export POP3_PORT=110
export DATABASE_PATH=./data/miko_email.db
export DOMAIN=yourdomain.com
```

5.3 é˜²ç«å¢™é…ç½®

Linux (iptables):
```bash
# å¼€æ”¾Webç«¯å£
sudo iptables -A INPUT -p tcp --dport 8080 -j ACCEPT

# å¼€æ”¾é‚®ä»¶ç«¯å£
sudo iptables -A INPUT -p tcp --dport 25 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 143 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 110 -j ACCEPT

# ä¿å­˜è§„åˆ™
sudo iptables-save > /etc/iptables/rules.v4
```

Linux (firewalld):
```bash
sudo firewall-cmd --permanent --add-port=8080/tcp
sudo firewall-cmd --permanent --add-port=25/tcp
sudo firewall-cmd --permanent --add-port=143/tcp
sudo firewall-cmd --permanent --add-port=110/tcp
sudo firewall-cmd --reload
```

===============================================================================
6. å¯åŠ¨æœåŠ¡
===============================================================================

6.1 ç›´æ¥å¯åŠ¨
```bash
# å‰å°è¿è¡Œ
./miko-email

# åå°è¿è¡Œ
nohup ./miko-email > logs/app.log 2>&1 &
```

6.2 ä½¿ç”¨systemdç®¡ç† (Linux)

åˆ›å»ºæœåŠ¡æ–‡ä»¶ /etc/systemd/system/miko-email.service:
```ini
[Unit]
Description=Miko Email Server
After=network.target

[Service]
Type=simple
User=miko
WorkingDirectory=/opt/miko-email
ExecStart=/opt/miko-email/miko-email
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡:
```bash
sudo systemctl daemon-reload
sudo systemctl enable miko-email
sudo systemctl start miko-email
sudo systemctl status miko-email
```

6.3 WindowsæœåŠ¡å®‰è£…
ä½¿ç”¨NSSMå·¥å…·å°†ç¨‹åºæ³¨å†Œä¸ºWindowsæœåŠ¡:
```cmd
nssm install MikoEmail
nssm set MikoEmail Application "C:\miko-email\miko-email.exe"
nssm set MikoEmail AppDirectory "C:\miko-email"
nssm start MikoEmail
```

===============================================================================
7. éªŒè¯éƒ¨ç½²
===============================================================================

7.1 æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
# æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tlnp | grep -E ':(8080|25|143|110)'

# æ£€æŸ¥è¿›ç¨‹
ps aux | grep miko-email
```

7.2 Webç•Œé¢æµ‹è¯•
1. æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://localhost:8080
2. ä½¿ç”¨ç®¡ç†å‘˜è´¦å·ç™»å½•: admin / 123456
3. æ£€æŸ¥å„åŠŸèƒ½æ¨¡å—æ˜¯å¦æ­£å¸¸

7.3 é‚®ä»¶åè®®æµ‹è¯•

SMTPæµ‹è¯•:
```bash
telnet localhost 25
HELO test.com
MAIL FROM: test@test.com
RCPT TO: user@yourdomain.com
DATA
Subject: Test Email

This is a test email.
.
QUIT
```

IMAPæµ‹è¯•:
```bash
telnet localhost 143
a1 LOGIN username password
a2 LIST "" "*"
a3 SELECT INBOX
a4 LOGOUT
```

===============================================================================
8. å¸¸è§é—®é¢˜
===============================================================================

8.1 ç«¯å£è¢«å ç”¨
é—®é¢˜: å¯åŠ¨æ—¶æç¤ºç«¯å£å·²è¢«ä½¿ç”¨
è§£å†³: 
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :8080
# æˆ–
netstat -tlnp | grep 8080

# æ€æ­»å ç”¨è¿›ç¨‹
kill -9 <PID>
```

8.2 æƒé™é—®é¢˜
é—®é¢˜: æ— æ³•ç»‘å®š25ç«¯å£ (Linux)
è§£å†³:
```bash
# æ–¹æ³•1: ä½¿ç”¨sudoè¿è¡Œ
sudo ./miko-email

# æ–¹æ³•2: è®¾ç½®capabilities
sudo setcap 'cap_net_bind_service=+ep' ./miko-email
```

8.3 æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥
é—®é¢˜: SQLiteæ•°æ®åº“åˆ›å»ºå¤±è´¥
è§£å†³:
```bash
# æ£€æŸ¥ç›®å½•æƒé™
ls -la data/

# åˆ›å»ºæ•°æ®ç›®å½•
mkdir -p data
chmod 755 data
```

8.4 Goæ¨¡å—ä¸‹è½½å¤±è´¥
é—®é¢˜: go mod tidy å¤±è´¥
è§£å†³:
```bash
# è®¾ç½®ä»£ç†
go env -w GOPROXY=https://goproxy.cn,direct

# æ¸…ç†æ¨¡å—ç¼“å­˜
go clean -modcache
go mod tidy
```

===============================================================================
9. å®‰å…¨é…ç½®
===============================================================================

9.1 SSL/TLSé…ç½®
```yaml
server:
  tls:
    enable: true
    cert_file: "/path/to/cert.pem"
    key_file: "/path/to/key.pem"
```

9.2 è®¿é—®æ§åˆ¶
```yaml
security:
  allowed_ips:
    - "192.168.1.0/24"
    - "10.0.0.0/8"
  rate_limit:
    enable: true
    requests_per_minute: 60
```

9.3 å¯†ç ç­–ç•¥
```yaml
security:
  password_policy:
    min_length: 8
    require_uppercase: true
    require_lowercase: true
    require_numbers: true
    require_symbols: true
```

===============================================================================
10. æ€§èƒ½ä¼˜åŒ–
===============================================================================

10.1 æ•°æ®åº“ä¼˜åŒ–
```yaml
database:
  max_connections: 100
  connection_timeout: 30
  enable_wal: true
```

10.2 ç¼“å­˜é…ç½®
```yaml
cache:
  enable: true
  type: "memory"
  ttl: 3600
  max_size: 1000
```

10.3 æ—¥å¿—é…ç½®
```yaml
logging:
  level: "info"
  file: "logs/app.log"
  max_size: 100
  max_backups: 10
  max_age: 30
```

===============================================================================
è”ç³»æ”¯æŒ
===============================================================================

å¦‚æœåœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·è”ç³»:
- QQ: 2014131458
- é‚®ç®±: 2014131458@qq.com
- é¡¹ç›®åœ°å€: https://github.com/your-repo/miko-email

===============================================================================